var homeEyeTimer,homelessPreTimer,homelessYearTimer,sec2Timer,updateTalkPeople,updateEarthStep,$sec1=$("#section-home"),$sec2=$("#section-homeless"),$sec3=$("#section-talk"),$sec4=$("#section-taiwan"),$sec5=$("#section-earth"),homeVideo=$(".video video",$sec1).get(0),earthVideo=$(".video video",$sec5).get(0),curTalkPeople=3,curEarthStep=0,lastEarthStep=0;$(function(){function e(){var e=$("#section-homeless .bg__pic.active")||$("#section-homeless .bg__pic:last-child");e.removeClass("active"),0<e.next().length?e.next().addClass("active"):$("#section-homeless .bg__pic").eq(0).addClass("active")}$(".fb-share").attr("href","https://www.facebook.com/share.php?u=https://change.greenpeace.org.tw/2019/ClimateStrike/?utm_campaign=2019-climate&utm_source=facebook&utm_medium=social&utm_content=cta_btn&hashtag=%23%E6%99%82%E9%96%93%E4%B8%8D%E5%A4%9A%E4%BA%86"),resizeCanvas(),$(homeVideo).on("ended",function(){}).on("timeupdate",function(){2.8<$(this).get(0).currentTime&&$sec1.addClass("fade-out"),14<=$(this).get(0).currentTime&&$sec1.hasClass("active")&&(homeVideo.pause(),$.fn.fullpage.moveSectionDown())}),$(".wave").on("aniDone",function(){1==aniFrames.wave.curFrame||aniFrames.wave.curFrame==aniFrames.wave.frames?($sec2.removeClass("enter"),$sec2.removeClass("play"),clearInterval(sec2Timer)):($sec1.removeClass("enter"),$sec3.removeClass("enter"),$sec2.addClass("play"),homeVideo.pause(),clearInterval(sec2Timer),sec2Timer=setInterval(e,4e3))});var t=$(".people",$sec3).length;(updateTalkPeople=function(){$(".people-container",$sec3).attr("data-step",curTalkPeople),$(".active",$sec3).removeClass("active"),$(".people:eq("+curTalkPeople+"), .text:eq("+curTalkPeople+")",$sec3).addClass("active")})(),$sec3.on("swiped-left",function(){t-1<++curTalkPeople&&(curTalkPeople=0),updateTalkPeople()}).on("swiped-right",function(){--curTalkPeople<0&&(curTalkPeople=t-1),updateTalkPeople()}).on("swiped-up",function(){$.fn.fullpage.setAllowScrolling(!0),$.fn.fullpage.moveSectionDown()}).on("swiped-down",function(){$.fn.fullpage.setAllowScrolling(!0),$.fn.fullpage.moveSectionUp()}),$(".prev",$sec3).on("click",function(){$sec3.trigger("swiped-right")}),$(".next",$sec3).on("click",function(){$sec3.trigger("swiped-left")}),$(".point",$sec4).on("click",function(){$.fn.fullpage.setAllowScrolling(!1),$sec4.addClass("enter"),$(".active",$sec4).removeClass("active"),$(this).addClass("active"),$('.info[data-area="'+$(this).data("area")+'"]',$sec4).addClass("active")}),$(".close-link",$sec4).on("click",function(){$.fn.fullpage.setAllowScrolling(!0),$(".active",$sec4).removeClass("active"),$sec4.removeClass("enter")}),$(".tip",$sec4).on("transitionend",function(){$sec4.hasClass("active")&&$(".point:eq(0)",$sec4).trigger("click")}),$(".info-container",$sec4).on("swiped-left",function(){var e=$(".point.active",$sec4);0<e.next().length?e.next().trigger("click"):$(".point:eq(0)",$sec4).trigger("click")}).on("swiped-right",function(){var e=$(".point.active",$sec4);0<e.prev().length?e.prev().trigger("click"):$(".point:last-child",$sec4).trigger("click")}).on("swiped-up",function(){$.fn.fullpage.setAllowScrolling(!0),$.fn.fullpage.moveSectionDown()}).on("swiped-down",function(){$.fn.fullpage.setAllowScrolling(!0),$.fn.fullpage.moveSectionUp()}),$(".prev",$sec4).on("click",function(){$(".info-container",$sec4).trigger("swiped-right")}),$(".next",$sec4).on("click",function(){$(".info-container",$sec4).trigger("swiped-left")}),$(earthVideo).on("ended",function(){earthVideo.currentTime=0,earthVideo.pause(),curEarthStep=0}).on("timeupdate",function(){if(!earthVideo.paused){var e=$(this).get(0).currentTime;console.log(e),0!=(pseudoCurEarthStep=curEarthStep)||lastEarthStep!=earthCount-2?e>=earthSteps[pseudoCurEarthStep]&&e<earthMedium?(earthVideo.pause(),lastEarthStep=curEarthStep):e>=earthPseudoMax-earthSteps[pseudoCurEarthStep]&&(earthVideo.pause(),earthVideo.currentTime=earthPseudoMax-earthVideo.currentTime,lastEarthStep=curEarthStep):e>=earthMedium&&(earthVideo.pause(),earthVideo.currentTime=0,curEarthStep=0)}}),updateEarthStep=function(e){e?(earthVideo.pause(),earthVideo.currentTime=0):(curEarthStep<lastEarthStep&&earthVideo.currentTime<earthMedium?earthVideo.currentTime=earthPseudoMax-earthVideo.currentTime:lastEarthStep<curEarthStep&&earthVideo.currentTime>earthMedium?earthVideo.currentTime=earthPseudoMax-earthVideo.currentTime:earthVideo.paused||lastEarthStep!=curEarthStep||(earthVideo.currentTime=earthPseudoMax-earthVideo.currentTime),curEarthStep>=earthCount-1&&(curEarthStep=0),earthVideo.play()),$(".active",$sec5).removeClass("active"),$(".text:eq("+curEarthStep+"), .bg:eq("+curEarthStep+")",$sec5).addClass("active"),curEarthStep==earthCount-2?($("#section-earth .arrow-down").stop().delay(3e3).fadeIn(),$("#section-earth .nav-container").fadeOut()):($("#section-earth .arrow-down").stop().fadeOut(),$("#section-earth .nav-container").fadeIn())},$sec5.on("swiped-left",function(){++curEarthStep>earthCount-1&&(curEarthStep=0),updateEarthStep()}).on("swiped-right",function(){--curEarthStep<0&&(curEarthStep=earthCount-2,earthVideo.currentTime=earthMedium),updateEarthStep()}).on("swiped-up",function(){$.fn.fullpage.setAllowScrolling(!0),$.fn.fullpage.moveSectionDown()}).on("swiped-down",function(){$.fn.fullpage.setAllowScrolling(!0),$.fn.fullpage.moveSectionUp()}),$(".prev",$sec5).on("click",function(){$sec5.trigger("swiped-right")}),$(".next",$sec5).on("click",function(){$sec5.trigger("swiped-left")}),$("#container").fullpage({keyboardScrolling:!1,bigSectionsDestination:"top",afterLoad:function(e,t){switch($(".years").text(1),updateEarthStep(!(curEarthStep=0)),t){case 1:$sec1.addClass("enter"),firstPlay||(homeVideo.currentTime=0,homeVideo.play());break;case 2:$(".years").text(1),$sec2.addClass("enter"),playCanvasAniTo("wave",aniFrames.wave.steps[0]),homelessPreTimer=setTimeout(function(){homelessYearTimer=setInterval(function(){var e=parseInt($(".years").text());e<30?$(".years").text(e+1):clearInterval(homelessYearTimer)},30),clearTimeout(homelessPreTimer)},500);break;case 5:$.fn.fullpage.setAllowScrolling(!1);break;case 4:$.fn.fullpage.setAllowScrolling(!1),$("#section-earth .nav-container").fadeIn()}},onLeave:function(e,t,a){switch(e){case 1:firstPlay=!1;break;case 2:clearTimeout(homelessPreTimer),clearInterval(homelessYearTimer),$sec2.removeClass("play"),clearInterval(sec2Timer),"up"==a?(playCanvasAniTo("wave",1,aniFrames.wave.steps[0]),$sec1.removeClass("fade-out"),$sec1.addClass("enter")):"down"==a&&(playCanvasAniTo("wave",!1,aniFrames.wave.steps[0]),$sec1.removeClass("enter"));break;case 3:$sec4.removeClass("enter"),$(".active",$sec4).removeClass("active")}4!=t&&$("#section-earth .arrow-down").stop().fadeOut(),1!=e&&(homeVideo.currentTime=0)}})});